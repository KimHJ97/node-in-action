# ìœ íš¨ì„± ê²€ì‚¬ ë° ë³€í™˜

## 1. Class Validator

class-validatorëŠ” TypeScript ë˜ëŠ” ES6 ì´ìƒì˜ JavaScriptì—ì„œ í´ë˜ìŠ¤ ê¸°ë°˜ ê°ì²´ì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë°ì½”ë ˆì´í„° ê¸°ë°˜ì˜ ìœ íš¨ì„± ê²€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ì£¼ë¡œ NestJSì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì§€ë§Œ, ë…ë¦½ì ìœ¼ë¡œë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

 - ë°ì½”ë ˆì´í„°(@IsString(), @IsNotEmpty() ë“±)ë¥¼ ì‚¬ìš©í•œ ì„ ì–¸ì  ê²€ì¦
 - ì»¤ìŠ¤í…€ ìœ íš¨ì„± ê²€ì‚¬ ì§€ì›
 - ë‹¤ì–‘í•œ ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬ê¸° ì œê³µ
 - class-transformerì™€ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ plain ê°ì²´ â†’ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ë³€í™˜ê³¼ ë™ì‹œì— ê²€ì¦ ê°€ëŠ¥

```bash
npm install class-validator
npm install class-transformer  # í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
```

### ìì£¼ ì‚¬ìš©í•˜ëŠ” ë°ì½”ë ˆì´í„°

 - @IsString(): ë¬¸ìì—´ì¸ì§€ ê²€ì‚¬
 - @IsNotEmpty(): ë¹ˆ ê°’ì´ ì•„ë‹Œì§€ ê²€ì‚¬
 - @IsEmail(): ì´ë©”ì¼ í˜•ì‹ì¸ì§€ ê²€ì‚¬
 - @IsNumber(): ìˆ«ìì¸ì§€ ê²€ì‚¬
 - @Min(n) / @Max(n): ìµœì†Œ/ìµœëŒ€ ìˆ«ìê°’ ê²€ì‚¬
 - @Length(min, max): ë¬¸ìì—´ ê¸¸ì´ ê²€ì‚¬
 - @IsOptional(): ê°’ì´ ì—†ì„ ê²½ìš° ìœ íš¨ì„± ê²€ì‚¬ ìƒëµ
 - `ê¸°ë³¸ Validator`
    - @IsDefined: null í˜¹ì€ undefinedì¸ ê²½ìš° ì‹¤íŒ¨
    - @Equals: íŠ¹ì • ê°’ì— í•´ë‹¹í•˜ëŠ”ì§€ ê²€ì‚¬
    - @NotEquals: íŠ¹ì • ê°’ì— í•´ë‹¹í•˜ë©´ ì‹¤íŒ¨
    - @IsEmpty: null í˜¹ì€ undefined í˜¹ì€ ë¹ˆë¬¸ìì—´ì¸ ê²½ìš° ì„±ê³µ
    - @IsNotEmpty: null í˜¹ì€ undefined í˜¹ì€ ë¹ˆë¬¸ìì—´ì¸ ê²½ìš° ì‹¤íŒ¨
    - @IsIn: ëª©ë¡ì— ìˆëŠ” ê°’ì¤‘ í•˜ë‚˜ì— í•´ë‹¹í•˜ëŠ”ì§€ ê²€ì‚¬
    - @IsNotIn: ëª©ë¡ì— ìˆëŠ” ê°’ì¤‘ í•˜ë‚˜ì— í•´ë‹¹í•˜ë©´ ì‹¤íŒ¨
 - `íƒ€ì… Validator`
    - @IsBoolean: Boolean íƒ€ì…ì¸ì§€ ê²€ì‚¬
    - @IsString: ë¬¸ìì—´ íƒ€ì…ì¸ì§€ ê²€ì‚¬
    - @IsNumber: ìˆ«ìí˜• íƒ€ì…ì¸ì§€ ê²€ì‚¬
    - @IsInt: ì •ìˆ˜í˜• íƒ€ì…ì¸ì§€ ê²€ì‚¬
    - @IsArray: ë¦¬ìŠ¤íŠ¸ íƒ€ì…ì¸ì§€ ê²€ì‚¬
    - @IsEnum: ENUM íƒ€ì…ì˜ ê°’ì— í•´ë‹¹í•˜ëŠ”ì§€ ê²€ì‚¬
    - @IsDate: ë‚ ì§œ ê°ì²´ íƒ€ì…ì¸ì§€
    - @IsDateString: ë‚ ì§œ íƒ€ì… ë¬¸ìì—´ì— í•´ë‹¹í•˜ëŠ”ì§€ ê²€ì‚¬
 - `ìˆ«ì Validator`
    - @IsDivisibleBy: íŠ¹ì • ê°’ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆëŠ” ê°’ì¸ì§€ ê²€ì‚¬
    - @IsPositive: ì–‘ìˆ˜ì¸ì§€ ê²€ì‚¬
    - @IsNegative: ìŒìˆ˜ì¸ì§€ ê²€ì‚¬
    - @Min: ìµœì†Œê°’ë³´ë‹¤ í°ì§€ ê²€ì‚¬
    - @Max: ìµœëŒ€ê°’ë³´ë‹¤ ì‘ì€ì§€ ê²€ì‚¬
 - `ë¬¸ì Validator`
    - @Contains: íŠ¹ì • ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€
    - @NotContains: íŠ¹ì • ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ì‹¤íŒ¨
    - @IsAlphanumeric: ì•ŒíŒŒë±ƒê³¼ ìˆ«ìë¡œë§Œ ì´ìš°ëŸ¬ì ¸ ìˆëŠ”ì§€ ê²€ì‚¬
    - @IsCreditCard: ì‹ ìš© ì¹´ë“œ í˜•íƒœ ë¬¸ìì—´ì¸ì§€ ê²€ì‚¬
    - @IsHexColor: 16ì§„ìˆ˜ ê²€ì‚¬
    - @MaxLength: ìµœëŒ€ ê¸¸ì´ ê²€ì‚¬
    - @MinLength: ìµœì†Œ ê¸¸ì´ ê²€ì‚¬
    - @IsUUID: UUID ê²€ì‚¬
    - @IsLatLong: ìœ„ë„, ê²½ì†Œ ê²€ì‚¬

### ì»¤ìŠ¤í…€ Validator

 - `ValidatorConstraintInterface êµ¬í˜„`
```typescript
import {
  ValidatorConstraint,
  ValidatorConstraintInterface,
  ValidationArguments,
} from 'class-validator';

@ValidatorConstraint({ name: 'isKoreanName', async: false }) // async: true ë„ ê°€ëŠ¥
export class IsKoreanNameConstraint implements ValidatorConstraintInterface {
  validate(value: string, args: ValidationArguments) {
    // í•œê¸€ë§Œ í—ˆìš©
    return /^[ê°€-í£]+$/.test(value);
  }

  defaultMessage(args: ValidationArguments) {
    return `${args.property}ì€(ëŠ”) í•œê¸€ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
  }
}
```

 - `ì»¤ìŠ¤í…€ ë°ì½”ë ˆì´í„° ì •ì˜`
```typescript
import { registerDecorator, ValidationOptions } from 'class-validator';

export function IsKoreanName(validationOptions?: ValidationOptions) {
  return function (object: Object, propertyName: string) {
    registerDecorator({
      name: 'isKoreanName',
      target: object.constructor,
      propertyName,
      options: validationOptions,
      validator: IsKoreanNameConstraint,
    });
  };
}
```

 - `ì»¤ìŠ¤í…€ ë°ì½”ë ˆì´í„° ì‚¬ìš©`
```typescript
import { IsNotEmpty } from 'class-validator';

export class CreateUserDto {
  @IsNotEmpty()
  @IsKoreanName({ message: 'ì´ë¦„ì€ í•œê¸€ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.' })
  name: string;
}
```

### ë°˜í™˜ ì—ëŸ¬ êµ¬ì¡°

 - target: ê²€ì¦í•œ ê°ì²´
 - property: ê²€ì¦ ì‹¤íŒ¨í•œ í”„ë¡œí¼í‹°
 - value: ê²€ì¦ ì‹¤íŒ¨í•œ ê°’
 - constraints: ê²€ì¦ ì‹¤íŒ¨í•œ ì œì•½ ì¡°ê±´
 - children: í”„ë¡œí¼í‹°ì˜ ëª¨ë“  ê²€ì¦ ì‹¤íŒ¨ ì œì•½ ì¡°ê±´
```javascript
{
    target: Object;
    property: string;
    value: any;
    constraints?: {
        [type: string]: string;
    };
    children?: ValidationError[];
}
```

### ì‚¬ìš© ì˜ˆì œ

```typescript
import { IsString, IsNotEmpty, IsEmail, validate } from 'class-validator';

class CreateUserDto {
  @IsEmail()
  email: string;

  @IsString()
  @IsNotEmpty()
  password: string;
}

const input = {
  email: 'test@example.com',
  password: '',
};

const user = Object.assign(new CreateUserDto(), input);

validate(user).then(errors => {
  if (errors.length > 0) {
    console.log('ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨:', errors);
  } else {
    console.log('ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼!');
  }
});
```

## 2. Class Transformer

class-transformerëŠ” Node.js (íŠ¹íˆ TypeScriptì™€ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš°)ì— ê°ì²´ ê°„ì˜ ë³€í™˜ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ì£¼ë¡œ Plain Object <-> Class ì¸ìŠ¤í„´ìŠ¤ ê°„ì˜ ë³€í™˜ì— ì‚¬ìš©ë˜ë©°, NestJSì—ì„œë„ ë§ì´ í™œìš©ë©ë‹ˆë‹¤.

 - plainToInstance(): JSON í˜¹ì€ JS ê°ì²´ë¥¼ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë³€í™˜
 - instanceToPlain(): í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ plain objectë¡œ ë³€í™˜
 - classToClass(): í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³µì œ (deep copy)
 - ë°ì½”ë ˆì´í„° ì‚¬ìš©: @Expose(), @Exclude(), @Transform() ë“±ì„ ì‚¬ìš©í•´ì„œ ì„¸ë¶€ ì œì–´ ê°€ëŠ¥
    - í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ @Expose(), @Exclude() ì§€ì • ê°€ëŠ¥
    - í•„ë“œ ë ˆë²¨ì—ì„œ @Expose(), @Exclude() ì§€ì • ê°€ëŠ¥
    - ê¸°ë³¸ ê°’ì€ @Expose()ë¡œ ì œì™¸í•  í•„ë“œ ìœ„ì— @Exclude() ì§€ì •í•  ìˆ˜ ìˆê³ , í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ @Excludeë¥¼ ëª…ì‹œí•˜ë©´ ì¶”ê°€í•  í•„ë“œ ìœ„ì— @Expose() ì§€ì •í•  ìˆ˜ë„ ìˆë‹¤.

```bash
npm install class-transformer
```

### 2-1. ê¸°ë³¸ ì‚¬ìš©ë²•

 - `í•¨ìˆ˜ ì´ìš©`
```javascript
import { plainToInstance } from 'class-transformer';

class User {
  firstName: string;
  lastName: string;

  get fullName() {
    return `${this.firstName} ${this.lastName}`;
  }
}

const plainUser = {
  firstName: 'John',
  lastName: 'Doe'
};

const userInstance = plainToInstance(User, plainUser);
console.log(userInstance instanceof User); // true
console.log(userInstance.fullName); // John Doe
```

 - `ë°ì½”ë ˆì´í„° ì‚¬ìš©`
```javascript
import 'reflect-metadata';
import {
  Exclude,
  Expose,
  Transform,
  Type,
  plainToInstance,
  instanceToPlain,
} from 'class-transformer';

// Address í´ë˜ìŠ¤
class Address {
  @Expose()
  city: string;

  @Expose()
  street: string;

  @Expose()
  zipCode: string;
}

// Order í´ë˜ìŠ¤
class Order {
  @Expose()
  itemName: string;

  @Expose()
  quantity: number;

  @Expose()
  @Transform(({ value }) => value * 1.1) // 10% ì„¸ê¸ˆ í¬í•¨
  price: number;
}

// User í´ë˜ìŠ¤
class User {
  @Expose()
  id: number;

  @Expose()
  name: string;

  @Exclude()
  password: string;

  @Expose()
  @Type(() => Address)
  address: Address;

  @Expose()
  @Type(() => Order)
  orders: Order[];

  @Expose()
  @Transform(({ value }) => value.toISOString(), { toPlainOnly: true })
  createdAt: Date;
}

// ì‚¬ìš© ì˜ˆì œ
const plainData = {
  id: 1,
  name: 'Alice',
  password: 'secret',
  address: {
    city: 'Seoul',
    street: 'Gangnam-daero',
    zipCode: '12345',
  },
  orders: [
    { itemName: 'Keyboard', quantity: 1, price: 10000 },
    { itemName: 'Mouse', quantity: 2, price: 15000 },
  ],
  createdAt: new Date(),
};

const user = plainToInstance(User, plainData, {
  excludeExtraneousValues: true,
});

console.log('ğŸ§ ì‚¬ìš©ì ì¸ìŠ¤í„´ìŠ¤:', user);
console.log('ğŸ“¦ ì§ë ¬í™”ëœ JSON:', instanceToPlain(user));
```

### 2-2. ì»¤ìŠ¤í…€ Transformer

 - `ê¸°ë³¸ êµ¬ì¡°`
    - toClassOnly: ì…ë ¥ ë³€í™˜ ì‹œ (plain â†’ class) ì‘ë™
    - toPlainOnly: ì¶œë ¥ ë³€í™˜ ì‹œ (class â†’ plain) ì‘ë™
    - ìƒëµ ì‹œ	ì–‘ìª½ ëª¨ë‘ì—ì„œ ì‘ë™
```javascript
@Transform(({ value, obj, key, type }) => {
  // ì»¤ìŠ¤í…€ ë³€í™˜ ë¡œì§
  return ë³€í™˜ëœê°’;
}, { toClassOnly: true | toPlainOnly: true })
```

 - ``
```javascript
// ë‚ ì§œ ë¬¸ìì—´ â†’ Date ê°ì²´ + ì¶œë ¥ì€ ISO ë¬¸ìì—´
export class CreateEventDto {
  @Transform(
    ({ value }) => new Date(value), 
    { toClassOnly: true }
  )
  @Transform(
    ({ value }) => value.toISOString(), 
    { toPlainOnly: true }
  )
  eventDate: Date;
}

// ì»¤ìŠ¤í…€ íŠ¸ëœìŠ¤í¬ë¨¸ í•¨ìˆ˜ ì¬ì‚¬ìš©
// utils/transformers.ts
export function trimString() {
  return Transform(({ value }) => (typeof value === 'string' ? value.trim() : value));
}

// dto.ts
import { trimString } from './utils/transformers';

export class CreateUserDto {
  @trimString()
  username: string;
}

// enum value ë§¤í•‘
// export enum UserRole {
  USER = 'USER',
  ADMIN = 'ADMIN',
}

@Transform(({ value }) => value.toUpperCase(), { toClassOnly: true })
role: UserRole;
```


## 3. Joi

JoiëŠ” JavaScript (íŠ¹íˆ Node.js)ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬(validation) ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

ê°„ë‹¨íˆ ë§í•˜ë©´, ì…ë ¥ ë°ì´í„°ì˜ íƒ€ì…, í˜•ì‹, ë²”ìœ„, ì¡°ê±´ ë“±ì„ ì„ ì–¸ì ìœ¼ë¡œ ì •ì˜í•˜ê³  ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìœ íš¨ì„±ì„ ì²´í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

 - Express, Koa, Fastify ê°™ì€ ì›¹ í”„ë ˆì„ì›Œí¬ì—ì„œ API ì…ë ¥ ê²€ì¦ì— ë§ì´ ì‚¬ìš©ë˜ë©°, NestJSì—ì„œëŠ” @hapi/joi ê¸°ë°˜ì˜ validation pipeë¥¼ ì„ íƒì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆë‹¤.
```bash
npm install joi

# NestJSìš© JOI
npm install @hapi/joi
```

### 3-1. ê¸°ë³¸ ì‚¬ìš©ë²•

 - JoiëŠ” í´ë˜ìŠ¤ ê¸°ë°˜ì´ ì•„ë‹ˆë¼ í•¨ìˆ˜í˜• ìŠ¤í‚¤ë§ˆ ì •ì˜ ë°©ì‹ì„ ì‚¬ìš©
 - classë¥¼ ì •ì˜í•˜ì§€ ì•Šê³ , Joi.object({...}) ê°™ì€ ë°©ì‹ìœ¼ë¡œ ê°ì²´ì˜ í˜•ì‹ê³¼ ì œì•½ ì¡°ê±´ì„ ì„ ì–¸ì ìœ¼ë¡œ ì •ì˜
```javascript
import Joi from 'joi';

const schema = Joi.object({
  username: Joi.string().min(3).max(30).required(),
  age: Joi.number().integer().min(0).max(120),
  email: Joi.string().email().required(),
});

const result = schema.validate({
  username: 'kim',
  age: 25,
  email: 'kim@example.com',
});

console.log(result.error); // ì—†ìœ¼ë©´ ìœ íš¨

// ì˜µì…˜ ì˜ˆì œ
const schema = Joi.object({
  password: Joi.string()
    .pattern(new RegExp('^[a-zA-Z0-9]{8,30}$'))
    .required(),

  confirmPassword: Joi.any().valid(Joi.ref('password')).required()
    .messages({
      'any.only': 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
    }),

  role: Joi.string().valid('user', 'admin').default('user'),
});
```

### 3-2. ì»¤ìŠ¤í…€ Validator

```javascript
const customJoi = Joi.extend((joi) => ({
  type: 'string',
  base: joi.string(),
  messages: {
    'string.isCapitalized': '"{{#label}}ì€ ëŒ€ë¬¸ìë¡œ ì‹œì‘í•´ì•¼í•©ë‹ˆë‹¤!"',
  },
  rules: {
    isCapitalized: {
      validate(value, helpers) {
        if (value[0] !== value[0].toUpperCase()) {
          return helpers.error('string.isCapitalized');
        }
        return value;
      }
    }
  }
}));

const schema = customJoi.object({
  name: customJoi.string().isCapitalized().required(),
  email: customJoi.string().email().required(),
});
```

### 3-3. NestJSì—ì„œ JOI ì‚¬ìš©í•˜ê¸°

NestJSì—ì„œëŠ” @nestjs/configì™€ ConfigModule.forRoot()ì— Joi ìŠ¤í‚¤ë§ˆë¥¼ í†µí•©í•´ì„œ í™˜ê²½ ë³€ìˆ˜ ìœ íš¨ì„± ê²€ì‚¬ ë“±ì— ì‚¬ìš©ëœë‹¤.

 - `config.schema.ts`
```javascript
// config.schema.ts
import * as Joi from 'joi';

export const configValidationSchema = Joi.object({
  PORT: Joi.number().default(3000),
  DATABASE_URL: Joi.string().uri().required(),
});
```

 - `app.module.ts`
```javascript
// app.module.ts
import { ConfigModule } from '@nestjs/config';
import { configValidationSchema } from './config.schema';

@Module({
  imports: [
    ConfigModule.forRoot({
      validationSchema: configValidationSchema,
    }),
  ],
})
export class AppModule {}
```

