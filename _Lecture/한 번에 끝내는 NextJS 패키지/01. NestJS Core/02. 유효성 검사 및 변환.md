# 유효성 검사 및 변환

## 1. Class Validator

class-validator는 TypeScript 또는 ES6 이상의 JavaScript에서 클래스 기반 객체의 유효성을 검증할 수 있게 해주는 데코레이터 기반의 유효성 검사 라이브러리입니다. 주로 NestJS와 함께 사용되지만, 독립적으로도 사용할 수 있습니다.

 - 데코레이터(@IsString(), @IsNotEmpty() 등)를 사용한 선언적 검증
 - 커스텀 유효성 검사 지원
 - 다양한 기본 유효성 검사기 제공
 - class-transformer와 함께 사용하여 plain 객체 → 클래스 인스턴스 변환과 동시에 검증 가능

```bash
npm install class-validator
npm install class-transformer  # 함께 사용하는 경우
```

### 자주 사용하는 데코레이터

 - @IsString(): 문자열인지 검사
 - @IsNotEmpty(): 빈 값이 아닌지 검사
 - @IsEmail(): 이메일 형식인지 검사
 - @IsNumber(): 숫자인지 검사
 - @Min(n) / @Max(n): 최소/최대 숫자값 검사
 - @Length(min, max): 문자열 길이 검사
 - @IsOptional(): 값이 없을 경우 유효성 검사 생략
 - `기본 Validator`
    - @IsDefined: null 혹은 undefined인 경우 실패
    - @Equals: 특정 값에 해당하는지 검사
    - @NotEquals: 특정 값에 해당하면 실패
    - @IsEmpty: null 혹은 undefined 혹은 빈문자열인 경우 성공
    - @IsNotEmpty: null 혹은 undefined 혹은 빈문자열인 경우 실패
    - @IsIn: 목록에 있는 값중 하나에 해당하는지 검사
    - @IsNotIn: 목록에 있는 값중 하나에 해당하면 실패
 - `타입 Validator`
    - @IsBoolean: Boolean 타입인지 검사
    - @IsString: 문자열 타입인지 검사
    - @IsNumber: 숫자형 타입인지 검사
    - @IsInt: 정수형 타입인지 검사
    - @IsArray: 리스트 타입인지 검사
    - @IsEnum: ENUM 타입의 값에 해당하는지 검사
    - @IsDate: 날짜 객체 타입인지
    - @IsDateString: 날짜 타입 문자열에 해당하는지 검사
 - `숫자 Validator`
    - @IsDivisibleBy: 특정 값으로 나눌 수 있는 값인지 검사
    - @IsPositive: 양수인지 검사
    - @IsNegative: 음수인지 검사
    - @Min: 최소값보다 큰지 검사
    - @Max: 최대값보다 작은지 검사
 - `문자 Validator`
    - @Contains: 특정 문자가 포함되어 있는지
    - @NotContains: 특정 문자가 포함되어 있으면 실패
    - @IsAlphanumeric: 알파뱃과 숫자로만 이우러져 있는지 검사
    - @IsCreditCard: 신용 카드 형태 문자열인지 검사
    - @IsHexColor: 16진수 검사
    - @MaxLength: 최대 길이 검사
    - @MinLength: 최소 길이 검사
    - @IsUUID: UUID 검사
    - @IsLatLong: 위도, 경소 검사

### 커스텀 Validator

 - `ValidatorConstraintInterface 구현`
```typescript
import {
  ValidatorConstraint,
  ValidatorConstraintInterface,
  ValidationArguments,
} from 'class-validator';

@ValidatorConstraint({ name: 'isKoreanName', async: false }) // async: true 도 가능
export class IsKoreanNameConstraint implements ValidatorConstraintInterface {
  validate(value: string, args: ValidationArguments) {
    // 한글만 허용
    return /^[가-힣]+$/.test(value);
  }

  defaultMessage(args: ValidationArguments) {
    return `${args.property}은(는) 한글만 입력 가능합니다.`;
  }
}
```

 - `커스텀 데코레이터 정의`
```typescript
import { registerDecorator, ValidationOptions } from 'class-validator';

export function IsKoreanName(validationOptions?: ValidationOptions) {
  return function (object: Object, propertyName: string) {
    registerDecorator({
      name: 'isKoreanName',
      target: object.constructor,
      propertyName,
      options: validationOptions,
      validator: IsKoreanNameConstraint,
    });
  };
}
```

 - `커스텀 데코레이터 사용`
```typescript
import { IsNotEmpty } from 'class-validator';

export class CreateUserDto {
  @IsNotEmpty()
  @IsKoreanName({ message: '이름은 한글만 입력해주세요.' })
  name: string;
}
```

### 반환 에러 구조

 - target: 검증한 객체
 - property: 검증 실패한 프로퍼티
 - value: 검증 실패한 값
 - constraints: 검증 실패한 제약 조건
 - children: 프로퍼티의 모든 검증 실패 제약 조건
```javascript
{
    target: Object;
    property: string;
    value: any;
    constraints?: {
        [type: string]: string;
    };
    children?: ValidationError[];
}
```

### 사용 예제

```typescript
import { IsString, IsNotEmpty, IsEmail, validate } from 'class-validator';

class CreateUserDto {
  @IsEmail()
  email: string;

  @IsString()
  @IsNotEmpty()
  password: string;
}

const input = {
  email: 'test@example.com',
  password: '',
};

const user = Object.assign(new CreateUserDto(), input);

validate(user).then(errors => {
  if (errors.length > 0) {
    console.log('유효성 검사 실패:', errors);
  } else {
    console.log('유효성 검사 통과!');
  }
});
```

## 2. Class Transformer

## 3. Joi

